import{j as e,p as j,w as g,u as v,r as m,x as N,y,B as i,h as b,C as w,f as C,z as D}from"./index-DimZnVXS.js";import{D as M,a as E,b as F,c as k,d as S}from"./dialog-B_4e8Vcw.js";const q=g("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function u({className:r,variant:a,...d}){return e.jsx("div",{className:j(q({variant:a}),r),...d})}function V(){const{toast:r}=v(),[a,d]=m.useState(null),[x,o]=m.useState(!1),{data:t,isLoading:h}=N({queryKey:["/api/admin/contact-messages"],queryFn:async()=>{const s=await fetch("/api/admin/contact-messages",{credentials:"include"});if(!s.ok)throw new Error("Falha ao carregar mensagens");return s.json()}}),p=y({mutationFn:async s=>{const n=await fetch(`/api/admin/contact-messages/${s}/read`,{method:"PUT",credentials:"include"});if(!n.ok)throw new Error("Falha ao marcar mensagem como lida");return n.json()},onSuccess:()=>{D.invalidateQueries({queryKey:["/api/admin/contact-messages"]}),r({title:"Sucesso",description:"Mensagem marcada como lida."})},onError:s=>{r({title:"Erro",description:s.message||"Ocorreu um erro ao atualizar a mensagem.",variant:"destructive"})}}),f=s=>{d(s),o(!0),s.read||p.mutate(s.id)},l=s=>{const n=new Date(s);return new Intl.DateTimeFormat("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(n)};if(h)return e.jsx("div",{className:"flex justify-center p-8",children:"Carregando mensagens..."});const c=(t==null?void 0:t.filter(s=>!s.read).length)||0;return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Mensagens de Contato"}),c>0&&e.jsxs("p",{className:"text-sm mt-1",children:["Você tem ",e.jsx(u,{variant:"destructive",children:c})," ",c===1?"mensagem não lida":"mensagens não lidas"]})]}),e.jsx(i,{variant:"outline",asChild:!0,children:e.jsx(b,{href:"/admin/dashboard",children:"Voltar ao Painel"})})]}),(t==null?void 0:t.length)===0?e.jsxs("div",{className:"text-center p-8 border rounded-lg bg-muted/50",children:[e.jsx("h3",{className:"text-xl font-medium",children:"Nenhuma mensagem recebida"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"As mensagens de contato aparecerão aqui quando os clientes enviarem."})]}):e.jsx("div",{className:"space-y-4",children:t==null?void 0:t.map(s=>e.jsx(w,{className:`transition-all hover:shadow-md ${s.read?"":"border-primary"}`,children:e.jsx(C,{className:"p-6",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-bold text-xl",children:s.name}),!s.read&&e.jsx(u,{variant:"secondary",children:"Nova"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.email," • ",s.phone]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Serviço: ",s.service]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Recebida em: ",l(s.createdAt)]}),e.jsx("p",{className:"mt-3 line-clamp-2",children:s.message})]}),e.jsx(i,{size:"sm",variant:"outline",onClick:()=>f(s),children:"Ver Detalhes"})]})})},s.id))}),e.jsx(M,{open:x,onOpenChange:o,children:e.jsx(E,{className:"sm:max-w-[600px]",children:a&&e.jsxs(e.Fragment,{children:[e.jsx(F,{children:e.jsxs(k,{children:["Mensagem de ",a.name]})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Nome:"}),e.jsx("p",{children:a.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Serviço de interesse:"}),e.jsx("p",{children:a.service})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Email:"}),e.jsx("p",{children:a.email})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Telefone:"}),e.jsx("p",{children:a.phone})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Data:"}),e.jsx("p",{children:l(a.createdAt)})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-2",children:"Mensagem:"}),e.jsx("div",{className:"p-4 bg-muted rounded-md whitespace-pre-wrap",children:a.message})]})]}),e.jsxs(S,{children:[e.jsx(i,{asChild:!0,variant:"secondary",children:e.jsx("a",{href:`mailto:${a.email}?subject=Re: Contato via site`,target:"_blank",rel:"noopener noreferrer",children:"Responder por Email"})}),e.jsx(i,{onClick:()=>o(!1),children:"Fechar"})]})]})})})]})}export{V as default};
