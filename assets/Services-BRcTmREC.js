import{i as K,r as a,k as Q,l as Y,j as e,P as q,m as Z,n as ee,o as te,p as R,u as se,a as re,B as l,h as P,C as ie,b as ae,f as ne,L as f,I as F,T as oe}from"./index-DimZnVXS.js";import{D as ce,a as le,b as de,c as ue,d as he}from"./dialog-B_4e8Vcw.js";var A="Switch",[me,be]=K(A),[pe,xe]=me(A),H=a.forwardRef((r,h)=>{const{__scopeSwitch:i,name:d,checked:c,defaultChecked:g,required:m,disabled:p,value:v="on",onCheckedChange:N,form:u,...o}=r,[x,E]=a.useState(null),D=Q(h,b=>E(b)),w=a.useRef(!1),C=x?u||!!x.closest("form"):!0,[n=!1,j]=Y({prop:c,defaultProp:g,onChange:N});return e.jsxs(pe,{scope:i,checked:n,disabled:p,children:[e.jsx(q.button,{type:"button",role:"switch","aria-checked":n,"aria-required":m,"data-state":$(n),"data-disabled":p?"":void 0,disabled:p,value:v,...o,ref:D,onClick:Z(r.onClick,b=>{j(T=>!T),C&&(w.current=b.isPropagationStopped(),w.current||b.stopPropagation())})}),C&&e.jsx(ve,{control:x,bubbles:!w.current,name:d,value:v,checked:n,required:m,disabled:p,form:u,style:{transform:"translateX(-100%)"}})]})});H.displayName=A;var _="SwitchThumb",B=a.forwardRef((r,h)=>{const{__scopeSwitch:i,...d}=r,c=xe(_,i);return e.jsx(q.span,{"data-state":$(c.checked),"data-disabled":c.disabled?"":void 0,...d,ref:h})});B.displayName=_;var ve=r=>{const{control:h,checked:i,bubbles:d=!0,...c}=r,g=a.useRef(null),m=ee(i),p=te(h);return a.useEffect(()=>{const v=g.current,N=window.HTMLInputElement.prototype,o=Object.getOwnPropertyDescriptor(N,"checked").set;if(m!==i&&o){const x=new Event("click",{bubbles:d});o.call(v,i),v.dispatchEvent(x)}},[m,i,d]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:i,...c,tabIndex:-1,ref:g,style:{...r.style,...p,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function $(r){return r?"checked":"unchecked"}var M=H,fe=B;const U=a.forwardRef(({className:r,...h},i)=>e.jsx(M,{className:R("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",r),...h,ref:i,children:e.jsx(fe,{className:R("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));U.displayName=M.displayName;function Se(){const{toast:r}=se(),[h,i]=re(),[d,c]=a.useState([]),[g,m]=a.useState(!0),[p,v]=a.useState(!1),[N,u]=a.useState(!1),[o,x]=a.useState(null),[E,D]=a.useState(!1),[w,C]=a.useState(!1),[n,j]=a.useState({title:"",description:"",icon:"",duration:"",price:"",active:!0});a.useEffect(()=>{async function t(){try{const s=await fetch("/api/admin/check-auth",{credentials:"include"});if(!s.ok)throw new Error("Falha ao verificar autenticação");if(!(await s.json()).authenticated){i("/admin/login");return}v(!0),b()}catch(s){console.error("Authentication error:",s),i("/admin/login")}}t()},[i]);async function b(){try{m(!0);const t=await fetch("/api/admin/services",{credentials:"include"});if(!t.ok)throw new Error("Falha ao carregar serviços");const s=await t.json();c(s)}catch(t){console.error("Error loading services:",t),r({title:"Erro",description:"Não foi possível carregar os serviços",variant:"destructive"})}finally{m(!1)}}const T=async()=>{try{if(!(await fetch("/api/admin/logout",{method:"POST",credentials:"include"})).ok)throw new Error("Falha ao fazer logout");r({title:"Logout realizado",description:"Você saiu do painel administrativo com sucesso."}),i("/admin/login")}catch(t){console.error("Logout error:",t),r({title:"Erro",description:"Ocorreu um erro ao fazer logout.",variant:"destructive"})}},L=()=>{j({title:"",description:"",icon:"",duration:"",price:"",active:!0}),x(null)},V=()=>{L(),u(!0)},G=t=>{x(t),j({title:t.title,description:t.description,icon:t.icon,duration:t.duration,price:t.price,active:t.active}),u(!0)},k=t=>{const{name:s,value:y}=t.target;j(S=>({...S,[s]:y}))},J=t=>{j(s=>({...s,active:t}))},W=async t=>{t.preventDefault(),D(!0);try{const s=o?`/api/admin/services/${o.id}`:"/api/admin/services",S=await fetch(s,{method:o?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n),credentials:"include"});if(!S.ok)throw new Error(`Falha ao ${o?"atualizar":"criar"} serviço`);const z=await S.json();c(o?I=>I.map(O=>O.id===z.id?z:O):I=>[...I,z]),u(!1),r({title:"Sucesso",description:`Serviço ${o?"atualizado":"criado"} com sucesso.`}),L()}catch(s){console.error("Error saving service:",s),r({title:"Erro",description:s instanceof Error?s.message:"Ocorreu um erro ao salvar",variant:"destructive"})}finally{D(!1)}},X=async t=>{if(confirm("Tem certeza que deseja excluir este serviço?")){C(!0);try{if(!(await fetch(`/api/admin/services/${t}`,{method:"DELETE",credentials:"include"})).ok)throw new Error("Falha ao excluir serviço");c(y=>y.filter(S=>S.id!==t)),r({title:"Sucesso",description:"Serviço excluído com sucesso."})}catch(s){console.error("Error deleting service:",s),r({title:"Erro",description:s instanceof Error?s.message:"Ocorreu um erro ao excluir",variant:"destructive"})}finally{C(!1)}}};return g||!p?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{children:"Carregando..."})}):e.jsxs("div",{className:"min-h-screen bg-slate-50",children:[e.jsx("header",{className:"bg-white border-b",children:e.jsx("div",{className:"container mx-auto px-4",children:e.jsxs("div",{className:"flex items-center justify-between py-4",children:[e.jsx("h1",{className:"text-xl font-bold",children:"Painel Administrativo"}),e.jsxs("nav",{className:"flex items-center space-x-2",children:[e.jsx(l,{variant:"ghost",size:"sm",asChild:!0,children:e.jsx(P,{href:"/admin/dashboard",children:"Dashboard"})}),e.jsx(l,{variant:"ghost",size:"sm",asChild:!0,children:e.jsx(P,{href:"/admin/services",children:"Serviços"})}),e.jsx(l,{variant:"ghost",size:"sm",asChild:!0,children:e.jsx(P,{href:"/admin/images",children:"Imagens"})}),e.jsx(l,{variant:"outline",size:"sm",asChild:!0,children:e.jsx(P,{href:"/",children:"Voltar ao site"})}),e.jsx(l,{variant:"destructive",size:"sm",onClick:T,children:"Sair"})]})]})})}),e.jsxs("main",{className:"container mx-auto p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Gerenciar Serviços"}),e.jsx(l,{onClick:V,children:"Adicionar Serviço"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:d.length===0?e.jsxs("div",{className:"col-span-full text-center p-8 border rounded-lg bg-muted/50",children:[e.jsx("h3",{className:"text-xl font-medium",children:"Nenhum serviço cadastrado"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:'Clique em "Adicionar Serviço" para começar'})]}):d.map(t=>e.jsxs(ie,{className:t.active?"":"opacity-70",children:[e.jsx(ae,{children:e.jsx("div",{className:"flex justify-between items-start mb-2",children:e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-xl",children:t.title}),e.jsxs("p",{className:"text-muted-foreground",children:[t.duration," • ",t.price]})]})})}),e.jsxs(ne,{children:[e.jsx("p",{className:"mb-4 line-clamp-3",children:t.description}),!t.active&&e.jsx("p",{className:"text-sm text-muted-foreground mb-4 italic",children:"Serviço inativo"}),e.jsxs("div",{className:"flex space-x-2 mt-4",children:[e.jsx(l,{size:"sm",variant:"outline",onClick:()=>G(t),children:"Editar"}),e.jsx(l,{size:"sm",variant:"destructive",onClick:()=>X(t.id),disabled:w,children:"Excluir"})]})]})]},t.id))}),e.jsx(ce,{open:N,onOpenChange:u,children:e.jsxs(le,{className:"sm:max-w-[525px]",children:[e.jsx(de,{children:e.jsx(ue,{children:o?"Editar Serviço":"Adicionar Serviço"})}),e.jsxs("form",{onSubmit:W,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(f,{htmlFor:"title",className:"text-right",children:"Título"}),e.jsx(F,{id:"title",name:"title",value:n.title,onChange:k,className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(f,{htmlFor:"icon",className:"text-right",children:"Ícone"}),e.jsx(F,{id:"icon",name:"icon",value:n.icon,onChange:k,className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(f,{htmlFor:"duration",className:"text-right",children:"Duração"}),e.jsx(F,{id:"duration",name:"duration",value:n.duration,onChange:k,className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(f,{htmlFor:"price",className:"text-right",children:"Preço"}),e.jsx(F,{id:"price",name:"price",value:n.price,onChange:k,className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(f,{htmlFor:"description",className:"text-right",children:"Descrição"}),e.jsx(oe,{id:"description",name:"description",value:n.description,onChange:k,className:"col-span-3",rows:3,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(f,{htmlFor:"active",className:"text-right",children:"Ativo"}),e.jsxs("div",{className:"col-span-3 flex items-center space-x-2",children:[e.jsx(U,{id:"active",checked:n.active,onCheckedChange:J}),e.jsx(f,{htmlFor:"active",className:"cursor-pointer",children:n.active?"Serviço ativo":"Serviço inativo"})]})]})]}),e.jsxs(he,{children:[e.jsx(l,{type:"button",variant:"outline",onClick:()=>u(!1),children:"Cancelar"}),e.jsx(l,{type:"submit",disabled:E,children:E?"Salvando...":"Salvar"})]})]})]})})]})]})}export{Se as default};
