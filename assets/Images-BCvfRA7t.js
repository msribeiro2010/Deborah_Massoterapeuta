import{u as M,a as Q,r as i,R as W,j as e,B as t,h as N,C as X,b as Y,f as Z,L as b,S as _,q as ee,s as ae,t as se,v as g,I as T,T as re}from"./index-DimZnVXS.js";import{D as ie,a as te,b as ne,c as oe,d as le}from"./dialog-B_4e8Vcw.js";function he(){const{toast:n}=M(),[ce,x]=Q(),[w,p]=i.useState([]),[z,y]=i.useState(!0),[L,O]=i.useState(!1),[A,m]=i.useState(!1),[c,C]=i.useState(null),[I,U]=i.useState(!1),[P,D]=i.useState(!1),[E,k]=i.useState(!1),[q,f]=i.useState(0),j=W.useRef(null),[o,h]=i.useState({section:"",imageUrl:"",title:"",description:""});i.useEffect(()=>{async function a(){try{const s=await fetch("/api/admin/check-auth",{credentials:"include"});if(!s.ok)throw new Error("Falha ao verificar autenticação");if(!(await s.json()).authenticated){x("/admin/login");return}O(!0),R()}catch(s){console.error("Authentication error:",s),x("/admin/login")}}a()},[x]);async function R(){try{y(!0);const a=await fetch("/api/admin/images",{credentials:"include"});if(!a.ok)throw new Error("Falha ao carregar imagens");const s=await a.json();p(s)}catch(a){console.error("Error loading images:",a),n({title:"Erro",description:"Não foi possível carregar as imagens",variant:"destructive"})}finally{y(!1)}}const $=async()=>{try{if(!(await fetch("/api/admin/logout",{method:"POST",credentials:"include"})).ok)throw new Error("Falha ao fazer logout");n({title:"Logout realizado",description:"Você saiu do painel administrativo com sucesso."}),x("/admin/login")}catch(a){console.error("Logout error:",a),n({title:"Erro",description:"Ocorreu um erro ao fazer logout.",variant:"destructive"})}},F=()=>{h({section:"",imageUrl:"",title:"",description:""}),C(null)},V=()=>{F(),m(!0)},H=a=>{C(a),h({section:a.section,imageUrl:a.imageUrl,title:a.title||"",description:a.description||""}),m(!0)},S=a=>{const{name:s,value:l}=a.target;h(r=>({...r,[s]:l}))},B=a=>{h(s=>({...s,section:a}))},G=async a=>{var l;const s=(l=a.target.files)==null?void 0:l[0];if(s){k(!0),f(10);try{const r=new FormData;r.append("image",s);const d=await fetch("/api/admin/upload-image",{method:"POST",body:r,credentials:"include"});if(f(90),!d.ok)throw new Error("Falha ao enviar imagem");const u=await d.json();h(v=>({...v,imageUrl:u.imageUrl})),n({title:"Sucesso",description:"Imagem enviada com sucesso"})}catch(r){console.error("Error uploading image:",r),n({title:"Erro",description:r instanceof Error?r.message:"Ocorreu um erro ao enviar a imagem",variant:"destructive"}),j.current&&(j.current.value="")}finally{f(100),setTimeout(()=>{k(!1),f(0)},500)}}},J=async a=>{a.preventDefault(),U(!0);try{const s=c?`/api/admin/images/${c.id}`:"/api/admin/images",r=await fetch(s,{method:c?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o),credentials:"include"});if(!r.ok)throw new Error(`Falha ao ${c?"atualizar":"adicionar"} imagem`);const d=await r.json();p(c?u=>u.map(v=>v.id===d.id?d:v):u=>[...u,d]),m(!1),n({title:"Sucesso",description:`Imagem ${c?"atualizada":"adicionada"} com sucesso.`}),F()}catch(s){console.error("Error saving image:",s),n({title:"Erro",description:s instanceof Error?s.message:"Ocorreu um erro ao salvar",variant:"destructive"})}finally{U(!1)}},K=async a=>{if(confirm("Tem certeza que deseja excluir esta imagem?")){D(!0);try{if(!(await fetch(`/api/admin/images/${a}`,{method:"DELETE",credentials:"include"})).ok)throw new Error("Falha ao excluir imagem");p(l=>l.filter(r=>r.id!==a)),n({title:"Sucesso",description:"Imagem excluída com sucesso."})}catch(s){console.error("Error deleting image:",s),n({title:"Erro",description:s instanceof Error?s.message:"Ocorreu um erro ao excluir",variant:"destructive"})}finally{D(!1)}}};return z||!L?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{children:"Carregando..."})}):e.jsxs("div",{className:"min-h-screen bg-slate-50",children:[e.jsx("header",{className:"bg-white border-b",children:e.jsx("div",{className:"container mx-auto px-4",children:e.jsxs("div",{className:"flex items-center justify-between py-4",children:[e.jsx("h1",{className:"text-xl font-bold",children:"Painel Administrativo"}),e.jsxs("nav",{className:"flex items-center space-x-2",children:[e.jsx(t,{variant:"ghost",size:"sm",asChild:!0,children:e.jsx(N,{href:"/admin/dashboard",children:"Dashboard"})}),e.jsx(t,{variant:"ghost",size:"sm",asChild:!0,children:e.jsx(N,{href:"/admin/services",children:"Serviços"})}),e.jsx(t,{variant:"ghost",size:"sm",asChild:!0,children:e.jsx(N,{href:"/admin/images",children:"Imagens"})}),e.jsx(t,{variant:"outline",size:"sm",asChild:!0,children:e.jsx(N,{href:"/",children:"Voltar ao site"})}),e.jsx(t,{variant:"destructive",size:"sm",onClick:$,children:"Sair"})]})]})})}),e.jsxs("main",{className:"container mx-auto p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Gerenciar Imagens"}),e.jsx(t,{onClick:V,children:"Adicionar Imagem"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:w.length===0?e.jsxs("div",{className:"col-span-full text-center p-8 border rounded-lg bg-muted/50",children:[e.jsx("h3",{className:"text-xl font-medium",children:"Nenhuma imagem cadastrada"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:'Clique em "Adicionar Imagem" para começar'})]}):w.map(a=>e.jsxs(X,{children:[e.jsxs(Y,{children:[e.jsx("div",{className:"aspect-w-16 aspect-h-9 mb-4 overflow-hidden rounded-md",children:e.jsx("img",{src:a.imageUrl,alt:a.title||"Imagem do site",className:"w-full h-48 object-cover",onLoad:()=>console.log("Imagem carregada na lista:",a.imageUrl),onError:s=>{console.error("Erro ao carregar imagem na lista:",a.imageUrl),s.target.src="https://via.placeholder.com/400x200?text=Erro+ao+carregar"}})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-xl",children:a.title||"Sem título"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Seção: ",a.section]})]})]}),e.jsxs(Z,{children:[a.description&&e.jsx("p",{className:"mb-4",children:a.description}),e.jsxs("div",{className:"flex space-x-2 mt-4",children:[e.jsx(t,{size:"sm",variant:"outline",onClick:()=>H(a),children:"Editar"}),e.jsx(t,{size:"sm",variant:"destructive",onClick:()=>K(a.id),disabled:P,children:"Excluir"})]})]})]},a.id))}),e.jsx(ie,{open:A,onOpenChange:m,children:e.jsxs(te,{className:"sm:max-w-[525px]",children:[e.jsx(ne,{children:e.jsx(oe,{children:c?"Editar Imagem":"Adicionar Imagem"})}),e.jsxs("form",{onSubmit:J,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(b,{htmlFor:"section",className:"text-right",children:"Seção"}),e.jsx("div",{className:"col-span-3",children:e.jsxs(_,{value:o.section,onValueChange:B,required:!0,children:[e.jsx(ee,{children:e.jsx(ae,{placeholder:"Selecione a seção"})}),e.jsxs(se,{children:[e.jsx(g,{value:"hero",children:"Hero (Topo)"}),e.jsx(g,{value:"about",children:"Sobre"}),e.jsx(g,{value:"gallery",children:"Galeria"}),e.jsx(g,{value:"ambiente",children:"Ambiente Tranquilo"}),e.jsx(g,{value:"testimonials",children:"Depoimentos"})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(b,{htmlFor:"imageUpload",className:"text-right",children:"Imagem"}),e.jsxs("div",{className:"col-span-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(t,{type:"button",variant:"outline",onClick:()=>{var a;return(a=j.current)==null?void 0:a.click()},disabled:E,children:E?"Enviando...":"Enviar arquivo"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"ou"}),e.jsx(T,{id:"imageUrl",name:"imageUrl",value:o.imageUrl,onChange:S,placeholder:"Digite a URL da imagem",className:"flex-1"})]}),e.jsx("input",{type:"file",ref:j,className:"hidden",accept:"image/*",onChange:G}),E&&e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-700 mt-2",children:e.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full",style:{width:`${q}%`}})})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(b,{htmlFor:"title",className:"text-right",children:"Título"}),e.jsx(T,{id:"title",name:"title",value:o.title,onChange:S,className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(b,{htmlFor:"description",className:"text-right",children:"Descrição"}),e.jsx(re,{id:"description",name:"description",value:o.description,onChange:S,className:"col-span-3",rows:3})]}),o.imageUrl&&e.jsxs("div",{className:"border rounded-md p-2 mt-2",children:[e.jsx("p",{className:"text-sm mb-2 text-muted-foreground",children:"Pré-visualização:"}),e.jsx("img",{src:o.imageUrl,alt:"Pré-visualização",className:"w-full h-48 object-cover rounded-md",onLoad:()=>console.log("Imagem carregada:",o.imageUrl),onError:a=>{console.error("Erro ao carregar imagem:",o.imageUrl),a.target.src="https://via.placeholder.com/400x200?text=Erro+ao+carregar+imagem"}})]})]}),e.jsxs(le,{children:[e.jsx(t,{type:"button",variant:"outline",onClick:()=>m(!1),children:"Cancelar"}),e.jsx(t,{type:"submit",disabled:I,children:I?"Salvando...":"Salvar"})]})]})]})})]})]})}export{he as default};
